<?xml version="1.0" encoding="utf-8" ?>
<Shell
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:views="clr-namespace:SistemaChamados.Mobile.Views"
    x:Class="SistemaChamados.Mobile.AppShell"
    FlyoutBehavior="Flyout"
    FlyoutBackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray950}}"
    Shell.TabBarBackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}"
    Shell.TabBarForegroundColor="{StaticResource Primary}"
    Shell.TabBarUnselectedColor="{StaticResource Gray500}"
    Shell.TabBarTitleColor="{StaticResource Primary}">

    <!-- Define o Header do Flyout (Menu Lateral) -->
    <Shell.FlyoutHeader>
        <VerticalStackLayout Padding="0" Spacing="0">
            <!-- Background com Gradiente -->
            <Grid HeightRequest="180">
                <Grid.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#1B3A5F" Offset="0" />
                        <GradientStop Color="#2A5FDF" Offset="1" />
                    </LinearGradientBrush>
                </Grid.Background>
                
                <!-- Logo NeuroHelp - Usa a versÃ£o light no background escuro -->
                <Image Source="neurohelp_light.png"
                       WidthRequest="120"
                       HeightRequest="120"
                       Aspect="AspectFit"
                       HorizontalOptions="Center"
                       VerticalOptions="Center" />
            </Grid>
            
            <!-- Card de InformaÃ§Ãµes do UsuÃ¡rio com sombra -->
            <Frame Padding="0" 
                   Margin="16,-30,16,16"
                   CornerRadius="16"
                   HasShadow="True"
                   BackgroundColor="{DynamicResource White}"
                   BorderColor="Transparent">
                <Grid Padding="20,16" RowDefinitions="Auto,Auto,Auto" RowSpacing="6">
                    <!-- Avatar com iniciais -->
                    <Border Grid.Row="0"
                            WidthRequest="56"
                            HeightRequest="56"
                            StrokeShape="RoundRectangle 28"
                            BackgroundColor="{StaticResource Primary}"
                            HorizontalOptions="Center"
                            StrokeThickness="3"
                            Stroke="{StaticResource Secondary}">
                        <Label x:Name="UserInitialsLabel"
                               Text="U"
                               FontSize="24"
                               FontAttributes="Bold"
                               TextColor="White"
                               HorizontalOptions="Center"
                               VerticalOptions="Center" />
                    </Border>
                    
                    <!-- Nome do UsuÃ¡rio -->
                    <Label Grid.Row="1"
                           x:Name="UserNameLabel"
                           Text="Carregando..."
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="{DynamicResource Gray900}"
                           HorizontalOptions="Center"
                           HorizontalTextAlignment="Center"
                           LineBreakMode="TailTruncation"
                           MaxLines="1"
                           Margin="0,8,0,0" />
                    
                    <!-- Email do UsuÃ¡rio -->
                    <HorizontalStackLayout Grid.Row="2"
                                          HorizontalOptions="Center"
                                          Spacing="6">
                        <Label Text="ðŸ“§"
                               FontSize="14"
                               VerticalOptions="Center" />
                        <Label x:Name="UserEmailLabel"
                               Text=""
                               FontSize="14"
                               TextColor="{DynamicResource Gray600}"
                               HorizontalOptions="Center"
                               LineBreakMode="TailTruncation"
                               MaxLines="1" />
                    </HorizontalStackLayout>
                </Grid>
            </Frame>
        </VerticalStackLayout>
    </Shell.FlyoutHeader>

    <!-- Define o Footer do Flyout (Menu Lateral) -->
    <Shell.FlyoutFooter>
        <VerticalStackLayout Padding="20" Spacing="16" BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray950}}">
            
            <!-- Divisor -->
            <BoxView HeightRequest="1" 
                     BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray700}}"
                     Margin="0,0,0,10" />
            
            <!-- Toggle Dark Mode -->
            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                <Label Grid.Column="0"
                       Text="ðŸŒ™"
                       FontSize="20"
                       VerticalOptions="Center" />
                <Label Grid.Column="1"
                       Text="Modo Escuro"
                       FontSize="16"
                       TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}"
                       VerticalOptions="Center" />
                <Switch Grid.Column="2"
                        x:Name="ThemeSwitch"
                        Toggled="OnThemeToggled"
                        VerticalOptions="Center"
                        OnColor="{StaticResource Primary}"
                        ThumbColor="White" />
            </Grid>

            <!-- BotÃ£o de Logout -->
            <Border StrokeShape="RoundRectangle 12"
                    BackgroundColor="{StaticResource Danger}"
                    Padding="16,12"
                    StrokeThickness="0">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnLogoutTapped" />
                </Border.GestureRecognizers>
                <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                    <Label Text="ðŸšª"
                           FontSize="18"
                           VerticalOptions="Center" />
                    <Label Text="Sair"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="White"
                           VerticalOptions="Center" />
                </HorizontalStackLayout>
            </Border>

            <!-- VersÃ£o do App -->
            <Label Text="VersÃ£o 1.0.0"
                   FontSize="12"
                   TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"
                   HorizontalOptions="Center"
                   Margin="0,10,0,0" />
        </VerticalStackLayout>
    </Shell.FlyoutFooter>

    <!-- Itens do Menu -->
    <FlyoutItem Title="Meus Chamados" Icon="ðŸ“‹">
        <ShellContent
            Title="Chamados"
            Route="chamados"
            ContentTemplate="{DataTemplate views:ChamadosListPage}" />
    </FlyoutItem>

</Shell>
