<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:SistemaChamados.Mobile.ViewModels"
             xmlns:dtos="clr-namespace:SistemaChamados.Mobile.Models.DTOs"
             x:Class="SistemaChamados.Mobile.Views.DashboardPage"
             x:DataType="viewmodels:DashboardViewModel"
             Title="InÃ­cio"
             Shell.NavBarIsVisible="True">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">
            
            <!-- Header com boas-vindas -->
            <Frame BackgroundColor="{StaticResource Primary}"
                   CornerRadius="16"
                   Padding="20"
                   HasShadow="False">
                <VerticalStackLayout Spacing="8">
                    <Label Text="{Binding Saudacao}"
                           FontSize="24"
                           FontAttributes="Bold"
                           TextColor="White" />
                    <Label Text="{Binding NomeUsuario}"
                           FontSize="18"
                           TextColor="White"
                           Opacity="0.9" />
                </VerticalStackLayout>
            </Frame>

            <!-- Cards de EstatÃ­sticas -->
            <Label Text="ðŸ“Š Resumo"
                   FontSize="20"
                   FontAttributes="Bold"
                   TextColor="{StaticResource Gray900}" />

            <Grid ColumnDefinitions="*,*" 
                  RowDefinitions="Auto,Auto"
                  ColumnSpacing="12"
                  RowSpacing="12">
                
                <!-- Card: Abertos -->
                <Frame Grid.Row="0" Grid.Column="0"
                       BackgroundColor="White"
                       CornerRadius="16"
                       Padding="16"
                       HasShadow="False"
                       BorderColor="{StaticResource Gray200}">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="ðŸŽ«"
                               FontSize="32"
                               HorizontalOptions="Center" />
                        <Label Text="{Binding TotalAbertos}"
                               FontSize="28"
                               FontAttributes="Bold"
                               TextColor="{StaticResource Primary}"
                               HorizontalOptions="Center" />
                        <Label Text="Abertos"
                               FontSize="14"
                               TextColor="{StaticResource Gray600}"
                               HorizontalOptions="Center" />
                    </VerticalStackLayout>
                </Frame>

                <!-- Card: Em Andamento -->
                <Frame Grid.Row="0" Grid.Column="1"
                       BackgroundColor="White"
                       CornerRadius="16"
                       Padding="16"
                       HasShadow="False"
                       BorderColor="{StaticResource Gray200}">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="âš™ï¸"
                               FontSize="32"
                               HorizontalOptions="Center" />
                        <Label Text="{Binding TotalEmAndamento}"
                               FontSize="28"
                               FontAttributes="Bold"
                               TextColor="{StaticResource Warning}"
                               HorizontalOptions="Center" />
                        <Label Text="Em Andamento"
                               FontSize="14"
                               TextColor="{StaticResource Gray600}"
                               HorizontalOptions="Center" />
                    </VerticalStackLayout>
                </Frame>

                <!-- Card: Encerrados -->
                <Frame Grid.Row="1" Grid.Column="0"
                       BackgroundColor="White"
                       CornerRadius="16"
                       Padding="16"
                       HasShadow="False"
                       BorderColor="{StaticResource Gray200}">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="âœ…"
                               FontSize="32"
                               HorizontalOptions="Center" />
                        <Label Text="{Binding TotalEncerrados}"
                               FontSize="28"
                               FontAttributes="Bold"
                               TextColor="{StaticResource Success}"
                               HorizontalOptions="Center" />
                        <Label Text="Encerrados"
                               FontSize="14"
                               TextColor="{StaticResource Gray600}"
                               HorizontalOptions="Center" />
                    </VerticalStackLayout>
                </Frame>

                <!-- Card: Tempo MÃ©dio -->
                <Frame Grid.Row="1" Grid.Column="1"
                       BackgroundColor="White"
                       CornerRadius="16"
                       Padding="16"
                       HasShadow="False"
                       BorderColor="{StaticResource Gray200}">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="â±ï¸"
                               FontSize="32"
                               HorizontalOptions="Center" />
                        <Label Text="{Binding TempoMedioAtendimento}"
                               FontSize="28"
                               FontAttributes="Bold"
                               TextColor="{StaticResource Info}"
                               HorizontalOptions="Center" />
                        <Label Text="Tempo MÃ©dio"
                               FontSize="14"
                               TextColor="{StaticResource Gray600}"
                               HorizontalOptions="Center" />
                    </VerticalStackLayout>
                </Frame>
            </Grid>

            <!-- Chamados Recentes -->
            <Label Text="ðŸ•’ Chamados Recentes"
                   FontSize="20"
                   FontAttributes="Bold"
                   TextColor="{StaticResource Gray900}"
                   Margin="0,10,0,0" />

            <CollectionView ItemsSource="{Binding ChamadosRecentes}"
                           SelectionMode="Single"
                           SelectionChanged="OnChamadoSelected">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="dtos:ChamadoDto">
                        <Frame BackgroundColor="White"
                               CornerRadius="12"
                               Padding="16"
                               Margin="0,0,0,12"
                               HasShadow="False"
                               BorderColor="{StaticResource Gray200}">
                            <Grid ColumnDefinitions="4,*,Auto" ColumnSpacing="12">
                                <!-- Border colorido por prioridade -->
                                <BoxView Grid.Column="0"
                                        Color="{Binding Prioridade.CorHexadecimal}"
                                        WidthRequest="4"
                                        CornerRadius="2" />

                                <!-- ConteÃºdo -->
                                <VerticalStackLayout Grid.Column="1" Spacing="6">
                                    <Label Text="{Binding Titulo}"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource Gray900}"
                                           LineBreakMode="TailTruncation"
                                           MaxLines="2" />
                                    
                                    <HorizontalStackLayout Spacing="8">
                                        <Frame BackgroundColor="{Binding Status.CorHexadecimal}"
                                               CornerRadius="12"
                                               Padding="8,4"
                                               HasShadow="False">
                                            <Label Text="{Binding Status.Nome}"
                                                   FontSize="11"
                                                   TextColor="White"
                                                   FontAttributes="Bold" />
                                        </Frame>
                                        
                                        <Label Text="{Binding Categoria.Nome}"
                                               FontSize="12"
                                               TextColor="{StaticResource Gray600}"
                                               VerticalOptions="Center" />
                                    </HorizontalStackLayout>

                                    <Label FontSize="11"
                                           TextColor="{StaticResource Gray500}">
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="ðŸ“… " />
                                                <Span Text="{Binding DataAbertura, Converter={StaticResource UtcToLocalConverter}, StringFormat='{0:dd/MM/yyyy HH:mm}'}" />
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>
                                </VerticalStackLayout>

                                <!-- Ãcone de navegaÃ§Ã£o -->
                                <Label Grid.Column="2"
                                       Text="â€º"
                                       FontSize="24"
                                       TextColor="{StaticResource Gray400}"
                                       VerticalOptions="Center" />
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

                <CollectionView.EmptyView>
                    <VerticalStackLayout Padding="40" Spacing="16" HorizontalOptions="Center">
                        <Label Text="ðŸ“­"
                               FontSize="48"
                               HorizontalOptions="Center" />
                        <Label Text="Nenhum chamado recente"
                               FontSize="16"
                               TextColor="{StaticResource Gray600}"
                               HorizontalOptions="Center" />
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
            </CollectionView>

            <!-- BotÃ£o Ver Todos -->
            <Button Text="Ver Todos os Chamados"
                    Command="{Binding VerTodosChamadosCommand}"
                    BackgroundColor="{StaticResource Primary}"
                    TextColor="White"
                    CornerRadius="12"
                    HeightRequest="50"
                    Margin="0,10,0,10" />

            <!-- BotÃ£o Novo Chamado -->
            <Button Text="âž• Novo Chamado"
                    Clicked="OnNovoChamadoClicked"
                    BackgroundColor="{StaticResource Success}"
                    TextColor="White"
                    CornerRadius="12"
                    HeightRequest="50"
                    FontAttributes="Bold"
                    Margin="0,0,0,20" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
