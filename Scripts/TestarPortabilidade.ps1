# ========================================
# TESTE DE PORTABILIDADE COMPLETO
# ========================================
# Este script testa se o sistema funciona de qualquer diret√≥rio/usu√°rio

param(
    [switch]$Quick,  # Teste r√°pido (apenas caminhos)
    [switch]$Full    # Teste completo (clona reposit√≥rio em outro local)
)

Clear-Host
Write-Host ""
Write-Host "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó" -ForegroundColor Cyan
Write-Host "‚ïë         üß™ TESTE DE PORTABILIDADE DO SISTEMA          ‚ïë" -ForegroundColor Cyan
Write-Host "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù" -ForegroundColor Cyan
Write-Host ""

$erros = 0
$avisos = 0
$sucessos = 0

function Test-Result {
    param([bool]$Sucesso, [string]$Mensagem, [string]$Detalhes = "")
    
    if ($Sucesso) {
        Write-Host "  ‚úÖ $Mensagem" -ForegroundColor Green
        $script:sucessos++
    } else {
        Write-Host "  ‚ùå $Mensagem" -ForegroundColor Red
        $script:erros++
    }
    
    if ($Detalhes) {
        Write-Host "     $Detalhes" -ForegroundColor Gray
    }
}

function Test-Warning {
    param([string]$Mensagem)
    Write-Host "  ‚ö†Ô∏è  $Mensagem" -ForegroundColor Yellow
    $script:avisos++
}

# ========================================
# TESTE 1: Verificar Caminhos Absolutos
# ========================================
Write-Host "[TESTE 1] Procurando caminhos absolutos hardcoded..." -ForegroundColor Yellow
Write-Host ""

$scriptDir = Split-Path -Parent $MyInvocation.MyCommand.Path
$repoRoot = Split-Path -Parent $scriptDir

$arquivos = Get-ChildItem -Path $repoRoot -Recurse -Include "*.ps1","*.cs","*.xaml","*.json" -Exclude "bin","obj","node_modules" -ErrorAction SilentlyContinue

$problemasEncontrados = @()

foreach ($arquivo in $arquivos) {
    $conteudo = Get-Content $arquivo.FullName -Raw -ErrorAction SilentlyContinue
    
    # Buscar padr√µes de caminhos absolutos
    $padroes = @(
        'c:\\Users\\[^"]*\\sistema-chamados',
        'C:\\Users\\[^"]*\\sistema-chamados',
        '/Users/[^"]*/sistema-chamados',
        'c:\\Users\\opera',
        'C:\\Users\\opera'
    )
    
    foreach ($padrao in $padroes) {
        if ($conteudo -match $padrao) {
            $match = $Matches[0]
            $problemasEncontrados += [PSCustomObject]@{
                Arquivo = $arquivo.FullName.Replace($repoRoot, "")
                Caminho = $match
            }
        }
    }
}

if ($problemasEncontrados.Count -eq 0) {
    Test-Result -Sucesso $true -Mensagem "Nenhum caminho absoluto encontrado" -Detalhes "Todos os scripts usam caminhos relativos"
} else {
    Test-Result -Sucesso $false -Mensagem "$($problemasEncontrados.Count) caminho(s) absoluto(s) encontrado(s)"
    $problemasEncontrados | ForEach-Object {
        Write-Host "     ‚Ä¢ $($_.Arquivo): $($_.Caminho)" -ForegroundColor Red
    }
}

Write-Host ""

# ========================================
# TESTE 2: Verificar Scripts com $PSScriptRoot
# ========================================
Write-Host "[TESTE 2] Verificando uso de `$PSScriptRoot nos scripts..." -ForegroundColor Yellow
Write-Host ""

$scriptsPs1 = Get-ChildItem -Path "$repoRoot\Scripts" -Filter "*.ps1" -ErrorAction SilentlyContinue

$scriptsSemRelativo = @()

foreach ($script in $scriptsPs1) {
    $conteudo = Get-Content $script.FullName -Raw
    
    # Verificar se usa $PSScriptRoot, $MyInvocation, ou Split-Path
    if ($conteudo -notmatch '\$PSScriptRoot|\$MyInvocation|Split-Path') {
        $scriptsSemRelativo += $script.Name
    }
}

if ($scriptsSemRelativo.Count -eq 0) {
    Test-Result -Sucesso $true -Mensagem "Todos os scripts usam caminhos relativos" -Detalhes "$($scriptsPs1.Count) scripts verificados"
} else {
    Test-Result -Sucesso $false -Mensagem "$($scriptsSemRelativo.Count) script(s) sem caminhos relativos"
    $scriptsSemRelativo | ForEach-Object {
        Write-Host "     ‚Ä¢ $_" -ForegroundColor Red
    }
}

Write-Host ""

# ========================================
# TESTE 3: Verificar appsettings.json
# ========================================
Write-Host "[TESTE 3] Verificando configura√ß√µes sens√≠veis..." -ForegroundColor Yellow
Write-Host ""

$appsettingsPath = Join-Path $repoRoot "Backend\appsettings.json"

if (Test-Path $appsettingsPath) {
    $appsettings = Get-Content $appsettingsPath -Raw
    
    # Verificar se n√£o tem credenciais expostas
    $credenciaisExpostas = @()
    
    if ($appsettings -match '@gmail\.com' -and $appsettings -notmatch 'CONFIGURE') {
        $credenciaisExpostas += "Email Gmail encontrado"
    }
    
    if ($appsettings -match 'sk-proj-[a-zA-Z0-9]+') {
        $credenciaisExpostas += "Chave OpenAI encontrada"
    }
    
    if ($appsettings -match '"Password".*:"[^"]{10}' -and $appsettings -notmatch 'CONFIGURE') {
        $credenciaisExpostas += "Senha encontrada"
    }
    
    if ($credenciaisExpostas.Count -eq 0) {
        Test-Result -Sucesso $true -Mensagem "appsettings.json est√° sanitizado" -Detalhes "Nenhuma credencial exposta"
    } else {
        Test-Result -Sucesso $false -Mensagem "Credenciais expostas em appsettings.json"
        $credenciaisExpostas | ForEach-Object {
            Write-Host "     ‚Ä¢ $_" -ForegroundColor Red
        }
    }
} else {
    Test-Warning "appsettings.json n√£o encontrado (esperado em novo setup)"
}

Write-Host ""

# ========================================
# TESTE 4: Verificar Constants.cs
# ========================================
Write-Host "`[TESTE 4`] Verificando Constants.cs (IP mobile)..." -ForegroundColor Yellow
Write-Host ""

$constantsPath = Join-Path $repoRoot "Mobile\Helpers\Constants.cs"

if (Test-Path $constantsPath) {
    $constants = Get-Content $constantsPath -Raw
    
    # Verificar se tem IP espec√≠fico hardcoded (que n√£o seja placeholder)
    if ($constants -match 'BaseUrlPhysicalDevice.*?http://192\.168\.\d+\.\d+:' -and 
        $constants -notmatch 'SEU_IP_LOCAL') {
        
        Test-Warning "Constants.cs tem IP espec√≠fico (n√£o √© problema se for o seu IP atual)"
        Write-Host "     Execute .\ConfigurarIP.ps1 antes de gerar APK para outro PC" -ForegroundColor Gray
    } elseif ($constants -match 'SEU_IP_LOCAL') {
        Test-Result -Sucesso $true -Mensagem "Constants.cs usa placeholder gen√©rico" -Detalhes "IP ser√° configurado por ConfigurarIP.ps1"
    } else {
        Test-Warning "Constants.cs em formato inesperado"
    }
} else {
    Test-Result -Sucesso $false -Mensagem "Constants.cs n√£o encontrado"
}

Write-Host ""

# ========================================
# TESTE 5: Simular Execu√ß√£o em Outro Diret√≥rio
# ========================================
if ($Full) {
    Write-Host "[TESTE 5] Simulando clone em outro diret√≥rio..." -ForegroundColor Yellow
    Write-Host ""
    
    $tempDir = Join-Path $env:TEMP "SistemaChamados_TestePortabilidade_$(Get-Date -Format 'yyyyMMdd_HHmmss')"
    
    try {
        # Criar diret√≥rio tempor√°rio
        New-Item -ItemType Directory -Path $tempDir -Force | Out-Null
        Write-Host "  üìÅ Diret√≥rio de teste: $tempDir" -ForegroundColor Gray
        Write-Host ""
        
        # Copiar arquivos essenciais (sem bin/obj)
        Write-Host "  üìã Copiando arquivos..." -ForegroundColor Cyan
        
        $excludeDirs = @("bin", "obj", "node_modules", ".git", ".vs", "APK")
        
        Get-ChildItem -Path $repoRoot -Recurse | Where-Object {
            $path = $_.FullName
            $shouldExclude = $false
            foreach ($exclude in $excludeDirs) {
                if ($path -like "*\$exclude\*") {
                    $shouldExclude = $true
                    break
                }
            }
            -not $shouldExclude -and $_.PSIsContainer -eq $false
        } | ForEach-Object {
            $relativePath = $_.FullName.Replace($repoRoot, "")
            $destPath = Join-Path $tempDir $relativePath
            $destDir = Split-Path $destPath -Parent
            
            if (-not (Test-Path $destDir)) {
                New-Item -ItemType Directory -Path $destDir -Force | Out-Null
            }
            
            Copy-Item $_.FullName -Destination $destPath -Force
        }
        
        Write-Host "  ‚úÖ Arquivos copiados" -ForegroundColor Green
        Write-Host ""
        
        # Testar scripts no novo diret√≥rio
        Write-Host "  üß™ Testando scripts no novo diret√≥rio..." -ForegroundColor Cyan
        Write-Host ""
        
        $scriptsTeste = @(
            "Scripts\ConfigurarIP.ps1",
            "Scripts\GerarAPK.ps1",
            "Scripts\IniciarAPI.ps1",
            "Scripts\ValidarConfigAPK.ps1"
        )
        
        $scriptsFalharam = @()
        
        foreach ($scriptTeste in $scriptsTeste) {
            $scriptPath = Join-Path $tempDir $scriptTeste
            
            if (Test-Path $scriptPath) {
                # Executar com -WhatIf ou parseamento est√°tico
                try {
                    # Parse do script para verificar sintaxe
                    $null = [System.Management.Automation.PSParser]::Tokenize((Get-Content $scriptPath -Raw), [ref]$null)
                    
                    # Verificar se o script detecta os caminhos corretamente
                    $scriptContent = Get-Content $scriptPath -Raw
                    
                    # Scripts devem usar $PSScriptRoot ou $MyInvocation
                    if ($scriptContent -match '\$PSScriptRoot|\$MyInvocation') {
                        Write-Host "    ‚úÖ $(Split-Path $scriptTeste -Leaf)" -ForegroundColor Green
                    } else {
                        Write-Host "    ‚ö†Ô∏è  $(Split-Path $scriptTeste -Leaf) - n√£o usa caminhos relativos" -ForegroundColor Yellow
                        $scriptsFalharam += $scriptTeste
                    }
                } catch {
                    Write-Host "    ‚ùå $(Split-Path $scriptTeste -Leaf) - erro de sintaxe" -ForegroundColor Red
                    $scriptsFalharam += $scriptTeste
                }
            } else {
                Write-Host "    ‚ö†Ô∏è  $(Split-Path $scriptTeste -Leaf) - n√£o encontrado" -ForegroundColor Yellow
            }
        }
        
        Write-Host ""
        
        if ($scriptsFalharam.Count -eq 0) {
            Test-Result -Sucesso $true -Mensagem "Todos os scripts funcionam no novo diret√≥rio" -Detalhes "Portabilidade confirmada"
        } else {
            Test-Result -Sucesso $false -Mensagem "$($scriptsFalharam.Count) script(s) com problemas"
        }
        
        Write-Host ""
        Write-Host "  üóëÔ∏è  Limpando diret√≥rio de teste..." -ForegroundColor Gray
        Remove-Item -Path $tempDir -Recurse -Force -ErrorAction SilentlyContinue
        Write-Host "  ‚úÖ Limpeza conclu√≠da" -ForegroundColor Green
        
    } catch {
        Test-Result -Sucesso $false -Mensagem "Erro ao testar em outro diret√≥rio" -Detalhes $_.Exception.Message
        
        if (Test-Path $tempDir) {
            Remove-Item -Path $tempDir -Recurse -Force -ErrorAction SilentlyContinue
        }
    }
    
    Write-Host ""
}

# ========================================
# TESTE 6: Verificar .gitignore
# ========================================
Write-Host "[TESTE 6] Verificando .gitignore..." -ForegroundColor Yellow
Write-Host ""

$gitignorePath = Join-Path $repoRoot ".gitignore"

if (Test-Path $gitignorePath) {
    $gitignore = Get-Content $gitignorePath -Raw
    
    $itensEssenciais = @(
        @{ Pattern = "appsettings\.json"; Nome = "Mobile/appsettings.json (ou **/Mobile/)"; Critico = $true },
        @{ Pattern = "DADOS_SENSIVEIS\.txt"; Nome = "DADOS_SENSIVEIS.txt"; Critico = $true },
        @{ Pattern = "\.env"; Nome = ".env files"; Critico = $false }
    )
    
    $faltando = @()
    
    foreach ($item in $itensEssenciais) {
        if ($gitignore -notmatch $item.Pattern) {
            $faltando += $item
        }
    }
    
    if ($faltando.Count -eq 0) {
        Test-Result -Sucesso $true -Mensagem ".gitignore protege arquivos sens√≠veis" -Detalhes "Todas as regras essenciais presentes"
    } else {
        $criticos = $faltando | Where-Object { $_.Critico }
        
        if ($criticos.Count -gt 0) {
            Test-Result -Sucesso $false -Mensagem "Regras cr√≠ticas faltando no .gitignore"
            $criticos | ForEach-Object {
                Write-Host "     ‚Ä¢ $($_.Nome)" -ForegroundColor Red
            }
        } else {
            Test-Warning "Algumas regras opcionais faltando no .gitignore"
        }
    }
} else {
    Test-Result -Sucesso $false -Mensagem ".gitignore n√£o encontrado"
}

Write-Host ""

# ========================================
# TESTE 7: Verificar se est√° em reposit√≥rio Git
# ========================================
Write-Host "[TESTE 7] Verificando reposit√≥rio Git..." -ForegroundColor Yellow
Write-Host ""

Push-Location $repoRoot

try {
    $gitStatus = git status 2>&1
    
    if ($LASTEXITCODE -eq 0) {
        Test-Result -Sucesso $true -Mensagem "Reposit√≥rio Git v√°lido"
        
        # Verificar se h√° arquivos sens√≠veis staged
        $staged = git diff --cached --name-only 2>&1
        
        if ($staged -match "DADOS_SENSIVEIS" -or $staged -match "Mobile.*appsettings\.json") {
            Test-Result -Sucesso $false -Mensagem "ATEN√á√ÉO: Arquivos sens√≠veis no stage" -Detalhes "Execute: git reset HEAD <arquivo>"
        }
    } else {
        Test-Warning "N√£o √© um reposit√≥rio Git (ou Git n√£o instalado)"
    }
} catch {
    Test-Warning "Git n√£o dispon√≠vel ou erro ao verificar"
} finally {
    Pop-Location
}

Write-Host ""

# ========================================
# RESULTADOS FINAIS
# ========================================
Write-Host ""
Write-Host "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó" -ForegroundColor Cyan
Write-Host "‚ïë                    üìä RESULTADOS                       ‚ïë" -ForegroundColor Cyan
Write-Host "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù" -ForegroundColor Cyan
Write-Host ""

$total = $sucessos + $erros + $avisos

Write-Host "  ‚úÖ Sucessos: $sucessos" -ForegroundColor Green
Write-Host "  ‚ùå Erros: $erros" -ForegroundColor Red
Write-Host "  ‚ö†Ô∏è  Avisos: $avisos" -ForegroundColor Yellow
Write-Host "  üìä Total: $total testes" -ForegroundColor Cyan
Write-Host ""

$percentualSucesso = [math]::Round(($sucessos / $total) * 100, 1)

if ($erros -eq 0) {
    Write-Host "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó" -ForegroundColor Green
    Write-Host "‚ïë         ‚úÖ SISTEMA 100% PORT√ÅTIL ($percentualSucesso% sucesso)          ‚ïë" -ForegroundColor Green
    Write-Host "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù" -ForegroundColor Green
    Write-Host ""
    Write-Host "‚ú® O sistema pode ser:" -ForegroundColor White
    Write-Host "   ‚Ä¢ Clonado em qualquer diret√≥rio" -ForegroundColor Gray
    Write-Host "   ‚Ä¢ Usado por qualquer usu√°rio Windows" -ForegroundColor Gray
    Write-Host "   ‚Ä¢ Movido entre PCs sem problemas" -ForegroundColor Gray
    Write-Host "   ‚Ä¢ Configurado automaticamente (ConfigurarIP.ps1)" -ForegroundColor Gray
    
}
elseif ($erros -le 2) {
    Write-Host "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó" -ForegroundColor Yellow
    Write-Host "‚ïë      ‚ö†Ô∏è  PORTABILIDADE COM PEQUENOS PROBLEMAS ($percentualSucesso%)     ‚ïë" -ForegroundColor Yellow
    Write-Host "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù" -ForegroundColor Yellow
    Write-Host ""
    Write-Host "Corrija os erros acima para portabilidade total." -ForegroundColor Yellow
    
} else {
    Write-Host "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó" -ForegroundColor Red
    Write-Host "‚ïë           ‚ùå PROBLEMAS DE PORTABILIDADE ($percentualSucesso%)          ‚ïë" -ForegroundColor Red
    Write-Host "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù" -ForegroundColor Red
    Write-Host ""
    Write-Host "Sistema precisa de corre√ß√µes antes de ser port√°til." -ForegroundColor Red
}

Write-Host ""

# ========================================
# PR√ìXIMOS PASSOS
# ========================================
if ($avisos -gt 0 -and $erros -eq 0) {
    Write-Host "üí° PR√ìXIMOS PASSOS (OPCIONAIS):" -ForegroundColor Cyan
    Write-Host ""
    Write-Host "   1. Revisar avisos acima" -ForegroundColor White
    Write-Host "   2. Executar: .\ConfigurarIP.ps1 (antes de gerar APK)" -ForegroundColor White
    Write-Host "   3. Testar clone em outro diret√≥rio: -Full" -ForegroundColor White
    Write-Host ""
}

if (-not $Full -and $erros -eq 0) {
    Write-Host "üß™ TESTE COMPLETO:" -ForegroundColor Yellow
    Write-Host ""
    Write-Host "   Execute: .\TestarPortabilidade.ps1 -Full" -ForegroundColor White
    Write-Host ""
    Write-Host "   Isso ir√°:" -ForegroundColor Gray
    Write-Host "   ‚Ä¢ Copiar projeto para diret√≥rio tempor√°rio" -ForegroundColor Gray
    Write-Host "   - Testar scripts no novo local" -ForegroundColor Gray
    Write-Host "   - Validar portabilidade completa" -ForegroundColor Gray
    Write-Host "   - Limpar automaticamente apos teste" -ForegroundColor Gray
    Write-Host ""
}

# Retornar c√≥digo de sa√≠da
if ($erros -eq 0) {
    exit 0
} else {
    exit 1
}
